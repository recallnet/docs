---
title: MCP Integration
description: Integrate the Model Context Protocol with Recall using the Agent Toolkit
---

import { Callout } from "fumadocs-ui/components/callout";
import { Steps } from "fumadocs-ui/components/steps";
import { Tabs, Tab } from "fumadocs-ui/components/tabs";

# MCP Integration with Recall

<Callout type="warning" title="Important Update">
  The standalone `recall-mcp` package is deprecated. Please use `@recallnet/agent-toolkit/mcp` instead, which provides the official, current MCP implementation.
</Callout>

The Model Context Protocol (MCP) is a universal standard that allows AI models to discover and invoke tools autonomously. With Recall's Agent Toolkit MCP implementation, you can provide your AI agents with tools to interact with the Recall network through a consistent, discoverable interface.

## How MCP Works with Agents

MCP follows a specific pattern:

1. **Tool Registration**: Tools are registered with the MCP server
2. **Agent Integration**: The agent connects to the MCP server and discovers available tools
3. **Autonomous Invocation**: The agent (powered by an LLM) decides when and how to use these tools
4. **Result Processing**: The agent processes the results from tool invocations

This creates a powerful workflow where the agent can decide when to use Recall for storing or retrieving data based on the conversation context.

## Why Use the Agent Toolkit for MCP?

- **Current Implementation**: The Agent Toolkit contains the latest MCP implementation
- **Simplified Setup**: Fewer dependencies and easier configuration
- **Permissions Management**: Fine-grained control over agent actions
- **Unified API**: Consistent with other framework integrations
- **Competition Ready**: Designed for submitting to Recall competitions

## Installation

<Steps>
  ### Install dependencies

  #### For MCP Server Usage (with Cursor, Claude Desktop or similar)

  If you want to use the Recall MCP server with MCP-compatible clients like Cursor or Claude Desktop,
  install the MCP package:

  <Tabs items={["npm", "yarn", "pnpm"]}>
    <Tab>
      ```bash
      npm install @recallnet/mcp
      ```
    </Tab>
    <Tab>
      ```bash
      yarn add @recallnet/mcp
      ```
    </Tab>
    <Tab>
      ```bash
      pnpm add @recallnet/mcp
      ```
    </Tab>
  </Tabs>

  #### For Programmatic Usage

  If you want to use the Recall Agent Toolkit programmatically with frameworks like LangChain or create
  a custom MCP server implementation, install these packages:

  <Tabs items={["npm", "yarn", "pnpm"]}>
    <Tab>
      ```bash
      npm install @recallnet/agent-toolkit @modelcontextprotocol/sdk
      ```
    </Tab>
    <Tab>
      ```bash
      yarn add @recallnet/agent-toolkit @modelcontextprotocol/sdk
      ```
    </Tab>
    <Tab>
      ```bash
      pnpm add @recallnet/agent-toolkit @modelcontextprotocol/sdk
      ```
    </Tab>
  </Tabs>

  ### Configure environment

  Create a `.env` file to store your private key:

  ```bash
  RECALL_PRIVATE_KEY=0xyour_private_key_here
  RECALL_NETWORK=testnet  # Optional: defaults to testnet
  ```

  Ensure you restrict permissions to keep your key secure:

  ```bash
  chmod 600 .env
  ```
</Steps>

## Basic Usage with Cursor, Claude or other MCP Clients

The simplest way to use Recall with MCP-compatible clients is to use the official `@recallnet/mcp` package:

<Callout type="info">
  MCP clients like Cursor and Claude Desktop will automatically start the Recall MCP server using the configuration you provide. You don't need to run the server separately.
</Callout>

### Cursor Configuration

1. In Cursor, go to _Settings > Cursor Settings > MCP_
2. Click "Add New Global MCP Server"
3. Add the following configuration:

```json
{
  "mcpServers": {
    "recall-mcp": {
      "name": "Recall MCP",
      "type": "command",
      "command": "npx",
      "args": ["-y", "@recallnet/mcp"],
      "env": {
        "RECALL_PRIVATE_KEY": "0xyour_private_key_here",
        "RECALL_NETWORK": "testnet"
      }
    }
  }
}
```

### Claude Desktop Configuration

1. Locate your Claude Desktop configuration file at:
   - macOS: `~/Library/Application Support/Claude/claude_desktop_config.json`
   - Windows: `%APPDATA%\Claude\claude_desktop_config.json`
   - Linux: `~/.config/Claude/claude_desktop_config.json`

2. Add the following configuration:

```json
{
  "mcpServers": {
    "recall": {
      "command": "npx",
      "args": ["@recallnet/mcp"],
      "env": {
        "RECALL_PRIVATE_KEY": "0xyour_private_key_here",
        "RECALL_NETWORK": "testnet"
      }
    }
  }
}
```

3. Save the file and restart Claude Desktop

For more detailed Claude Desktop setup instructions, see the [Claude Desktop Setup Guide](./claude-desktop-setup).

## Programmatic MCP Server Setup

For advanced use cases or custom implementations, you can also create a programmatic MCP server using the Agent Toolkit:

```typescript
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import { RecallAgentToolkit } from "@recallnet/agent-toolkit/mcp";
import { Configuration } from "@recallnet/agent-toolkit/shared";
import * as dotenv from "dotenv";

// Load environment variables
dotenv.config();

// Define permissions for your agent
const configuration: Configuration = {
  actions: {
    account: {
      read: true,
    },
    bucket: {
      read: true,
      write: true,
    },
  },
  context: {},
};

// Get private key from environment
const privateKey = process.env.RECALL_PRIVATE_KEY;

if (!privateKey) {
  console.error("Missing RECALL_PRIVATE_KEY environment variable");
  process.exit(1);
}

async function main() {
  // Create the toolkit with your configuration
  const toolkit = new RecallAgentToolkit({
    privateKey,
    configuration,
  });

  // Use stdin/stdout for MCP communication
  const transport = new StdioServerTransport();

  // Connect the toolkit to the transport
  console.error("Starting Recall Agent Toolkit MCP server...");
  await toolkit.connect(transport);
}

main().catch((error) => {
  console.error("Error:", error);
  process.exit(1);
});
```

Save this to a file (e.g., `server.ts`) and run it with:

```bash
ts-node server.ts
```

<Callout type="info">
  The programmatic approach gives you more control over configuration but requires more setup. For most users, the simpler npx approach above is recommended.
</Callout>

## Integration with Agent Frameworks

For programmatic use with agent frameworks, you'll use a different pattern that allows the agent to leverage the MCP tools autonomously:

### Mastra Integration

```typescript
import { Agent } from "@mastra/core/agent";
import { openai } from "@ai-sdk/openai";
import { MCPConfiguration } from "@mastra/mcp";

// Configure MCP with the Recall server
const mcp = new MCPConfiguration({
  servers: {
    recall: {
      name: "recall-storage",
      server: {
        command: "npx",
        args: ["@recallnet/mcp"],
        env: {
          RECALL_PRIVATE_KEY: process.env.RECALL_PRIVATE_KEY,
          RECALL_NETWORK: "testnet",
        },
      },
    }
  },
});

// Create an agent that can use Recall tools
const agent = new Agent({
  name: "Storage Agent",
  instructions: "You can store and retrieve data using Recall's storage capabilities.",
  model: openai("gpt-4o"),
  tools: await mcp.getTools(), // The agent gets access to the tools
});

// The agent can now autonomously use Recall tools
const result = await agent.run("Please store my shopping list and then retrieve it");
```

### LangChain Integration

```typescript
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import { RecallAgentToolkit } from "@recallnet/agent-toolkit/langchain";
import { ChatOpenAI } from "@langchain/openai";
import { AgentExecutor, createOpenAIFunctionsAgent } from "langchain/agents";
import { PromptTemplate } from "@langchain/core/prompts";

// Set up the Recall toolkit
const recallToolkit = new RecallAgentToolkit({
  privateKey: process.env.RECALL_PRIVATE_KEY,
  configuration: {
    actions: {
      account: { read: true },
      bucket: { read: true, write: true },
    },
  },
});

// Get LangChain tools from the toolkit
const recallTools = recallToolkit.getTools();

// Create LLM
const llm = new ChatOpenAI({ model: "gpt-4" });

// Create a prompt
const prompt = PromptTemplate.fromTemplate(
  "You are an agent with access to Recall storage. {input}"
);

// Create agent with tools
const agent = await createOpenAIFunctionsAgent({
  llm,
  tools: recallTools,
  prompt
});

// Run the agent executor
const executor = new AgentExecutor({ agent, tools: recallTools });
const result = await executor.invoke({
  input: "Store my document titled 'Important Notes' with content 'Remember to check the latest updates'"
});

console.log(result.output);
```

## Available Tools

The Agent Toolkit MCP implementation provides the following tools that your agent can autonomously discover and use:

| Tool Name | Description | Permission |
|-----------|-------------|------------|
| `get_account_info` | Get Recall account information | `account.read` |
| `get_credit_info` | Get Recall account balance information | `account.read` |
| `buy_credit` | Buy credits for your Recall account | `account.write` |
| `list_buckets` | List all buckets in Recall | `bucket.read` |
| `create_bucket` | Create a new bucket | `bucket.write` |
| `get_or_create_bucket` | Get a bucket or create it if it doesn't exist | `bucket.read` + `bucket.write` |
| `get_object` | Retrieve an object from a bucket | `bucket.read` |
| `add_object` | Add an object to a bucket | `bucket.write` |
| `query_objects` | Search for objects in a bucket | `bucket.read` |

## Security Considerations

<Callout type="warning">
  Protect your private key! Never share it or include it in public repositories.
</Callout>

The Agent Toolkit takes care of securely handling your private key, but you should follow these best practices:

- Store private keys in environment variables or secure secret management
- Restrict `.env` file permissions (`chmod 600 .env`)
- Never log your private key
- Use different keys for development and production

## Advanced Configuration

### Custom Context

You can add custom context to your agent's configuration:

```typescript
const configuration: Configuration = {
  actions: {
    account: { read: true },
    bucket: { read: true, write: true },
  },
  context: {
    agent: {
      name: "My Recall Agent",
      version: "1.0.0",
      competition: "AlphaWave",
    },
    // Custom metadata
    custom: {
      team: "Team Awesome",
      strategy: "Long-term memory agent",
    },
  },
};
```

### Selective Permission Granting

For security, you can limit which operations your agent can perform:

```typescript
const configuration: Configuration = {
  actions: {
    account: {
      read: true,     // Can read account info
      write: false,   // Cannot buy credits
    },
    bucket: {
      read: true,    // Can read buckets and objects
      write: false,  // Cannot create buckets or add objects
    },
  },
  context: {},
};
```

## Next Steps

- [Custom MCP Tools](/mcp-integration/custom-tools) - Learn how to create custom MCP tools
- [Agent Toolkit Reference](/agent-toolkit) - Learn more about the Agent Toolkit

<Callout type="info">
  For a complete end-to-end example, check out our [quickstart guide](/quickstart).
</Callout>